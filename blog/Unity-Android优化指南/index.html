<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><title> Unity: Android优化指南(上) | 编程人生 - 记录编程生活的点点滴滴，努力提升自己。</title><meta name=description content=""><meta http-equiv="cache-control" content="max-age=29030400"/><meta http-equiv="pragma" content="public"><meta name="keywords" content="编程, 程序, 自我提升" /><meta name="author" content="xiaofeng" /><meta http-equiv="Content-Language" content="zh"><meta property="og:locale" content="zh" /><meta property="og:site_name" content="编程人生" /><meta property="og:type" content="WebSite" /><meta property="og:url" content="https://flyingeye.cn/blog/Unity-Android%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/" /><meta property="og:description" content="记录编程生活的点点滴滴，努力提升自己。" /><meta property="og:title" content="Unity: Android优化指南(上)" /><link rel="canonical" href="https://flyingeye.cn/blog/Unity-Android%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/"><link rel="alternate" type="application/rss+xml" title="编程人生" href="https://flyingeye.cn/feed.xml"><link rel="icon" type="image/png" sizes="32x32" href="https://flyingeye.cn/assets/images/favicon/favicon-32x32.ico"><link href="https://fonts.googleapis.com/css?family=Gloria+Hallelujah" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Gloria+Hallelujah|Space+Mono:400,400i,700,700i" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i" rel="stylesheet"> <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script><link rel="stylesheet" href="/assets/css/vendor.css"><link rel="stylesheet" href="/assets/css/hacking.css"></head><body id="top"><div class="layout_default layout_default__bg">
<div class="container layout_default__container"><div class="row">
<div class="p-0 col-lg-3 sidebar sidebar__bg"><div class="container-fluid">
<div class="sidebar__header"><div class="mt-4 row">
<div class="mb-0 mb-lg-4 col-3 col-sm-3 col-lg-12"> <a class="sidebar__img sidebar__img-noflip" href="https://flyingeye.cn/"> <img class="img-fluid mx-auto d-block border-dashed" src="/assets/images/avatar/WechatIMG9.jpeg" width="165" height="165" alt="Avatar"> </a>
</div>
<div class=" col-9 col-sm-9 col-lg-12"> <a class="text-d-none sidebar__title" href="https://flyingeye.cn/"><h1 class="sidebar__title--text">乐生</h1></a>
</div>
</div></div>
<div class="mt-4 sidebar__menu"><div class="row"><ul class="px-3 mx-2 px-lg-3 mx-lg-3 sidebar__menu-list">
<li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"> <i class="mr-1 fas fa-home"></i> <a class="sidebar__menu-item__link" href="https://flyingeye.cn/">首页</a>
</li>
<hr class="hr-dashed">
<li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"> <i class="mr-1 fas fa-edit"></i> <a class="sidebar__menu-item__link" href="https://flyingeye.cn/blog/">博客</a>
</li>
<li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"> <i class="mr-1 fas fa-search"></i> <a class="sidebar__menu-item__link" href="https://flyingeye.cn/blog/search/">搜索</a>
</li>
<li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"> <i class="mr-1 fas fa-tags"></i> <a class="sidebar__menu-item__link" href="https://flyingeye.cn/blog/tags/">标签</a>
</li>
<li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"> <i class="mr-1 fas fa-envelope"></i> <a class="sidebar__menu-item__link" href="https://flyingeye.cn/contact/">联系</a>
</li>
<li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"> <i class="mr-1 fas fa-briefcase"></i> <a class="sidebar__menu-item__link" href="https://flyingeye.cn/projects/">项目</a>
</li>
<li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"> <i class="mr-1 fas fa-file-alt"></i> <a class="sidebar__menu-item__link" href="https://flyingeye.cn/resume/">简历</a>
</li>
<li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"> <i class="mr-1 fas fa-rss"></i> <a class="sidebar__menu-item__link" href="https://flyingeye.cn/feed.xml" target="_blank">Feed</a>
</li>
</ul></div></div>
<div class="sidebar__socials"><div class="row justify-content-center"><ul class="p-0 list-none sidebar__socials-list">
<div class="mt-0 mb-0 mt-lh-1 mb-lg-1 d-block row"><h4 class="font-weight-bold text-center sidebar__socials-title"></h4></div>
<div class="mt-0 mb-0 mt-lh-1 mb-lg-1 d-block row"><h4 class="font-weight-bold text-center sidebar__socials-title">联系我!</h4></div>
<li id="github" class="sidebar__socials-item"> <a class="mr-3 sidebar__socials-link" title="GitHub" href="https://github.com" target="_blank"><i class="fab fa-github sidebar__socials-icon" aria-hidden="true"></i></a>
</li>
</ul></div></div>
</div></div>
<div class="pt-4 pt-lg-0 col-lg-9 border-l-dashed border-r-dashed layout_default__content"><div class="p-lg-4 mt-4 mt-lg-0 layout_post" itemscope itemtype="http://schema.org/BlogPosting"><div class="container-fluid">
<div class="row"><h1 class="font-weight-bold layout_post__title">Unity: Android优化指南(上)</h1></div>
<div class="mb-2 mt-2 mb-lg-4 mt-lg-4 layout_post__date"><div class="row"><div class=" col-12 col-lg-12 offset-lg-0 col-sm-12 "><div class="row justify-content-start"> <time class="layout_post__time"> <i class="far fa-calendar-alt"></i> 八月 18, 2019 </time>
</div></div></div></div>
<div class="layout_post__tags"><div class="row"> <i class="fa fa-tags"></i> Tags:  <a class="layout-post__tags-link" href="https://flyingeye.cn/blog/tags//Unity">Unity</a>,  <a class="layout-post__tags-link" href="https://flyingeye.cn/blog/tags//Android">Android</a>,  <a class="layout-post__tags-link" href="https://flyingeye.cn/blog/tags//%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97">优化指南</a>, </div></div>
<div class="layout-post__reading_time"><div class="row"> 阅读“关于 1 分钟</div></div>
<div class="layout_post__content"><div class="row d-block">
<ul id="markdown-toc"><li><a href="#gist-code" id="markdown-toc-gist-code">Gist code</a></li></ul>
<p>Hi! <img class="emoji" title=":hand:" alt=":hand:" src="https://github.githubassets.com/images/icons/emoji/unicode/270b.png" height="20" width="20"></p>
<p>文章来源：<a href="https://medium.com/ironequal/android-optimization-with-unity-3504b34f00b0" target="_blank">Unity: Android Optimization Guide</a></p>
<p>一切都很好，直到你意识到缺乏优化会杀死你的游戏。</p>
<p>介绍 就像所有在Unity中工作的人，在Android和Ios项目中，你都会在某些时候遇到性能问题，FPS下降、延迟、延迟等，这些问题会干扰你的游戏甚至会毁掉它。</p>
<p>你可以确定是时候深入你的项目并对其进行优化了。 这是这个指南的摘要，能帮助你更好的导航：</p>
<div class="row imager" style="margin: 40px 0px;"> <img class="img-fluid mx-auto d-block" src="/assets/images/posts/Unity-Android_1.png" title="Unity-Android_1.png" alt="Unity-Android_1.png">
</div>
<p>分析你的游戏</p>
<p>Unity分析器 为了观察和分析你的项目性能，你必须使用Unity分析器（Window-&gt;Profile）。它让你直观的看到你的游戏在做什么，什么比较耗时，每帧渲染需要多长时间，什么在消耗你游戏的性能。</p>
<p>它真的很好使用，你仅仅点击点击图形，例如尖峰图，就可以得到帧计算的细节。Unity向你展示花费最多时间的进程。为了更好的理解这些进程，立刻使用Google搜索他们的名字，你将在论坛上发现一篇相关的帖子。</p>
<p>Unity分析器工作在编辑器上，向你展示你的游戏正在做什么，但是要注意它并不代表你的游戏的真实性能。Unity编辑器同时处理其他的进程，而不仅仅是你的进程，因此相比于你的游戏简单编译，它会运行的比较慢。</p>
<p>远程分析器 这就是我们为什么必须编译你的游戏，并且从你的android设备上分析它。 一旦你已经配置了Android SDK和JDK去配置你的项目【https://docs.unity3d.com/Manual/android-sdksetup.html】，你就可以使用远程分析器。 在编译设置里（File-&gt;Build Settings…）,你只需要勾选开发编译和自动连接分析器，并且确定在编辑器设置中（Edit-&gt;Project Setting-&gt;Editor）设备选项要被设置成任何android设备。</p>
<div class="row imager" style="margin: 40px 0px;"> <img class="img-fluid mx-auto d-block" src="/assets/images/posts/Unity-Android_2.png" title="Unity-Android_2.png" alt="Unity-Android_2.png">
</div>
<p>现在，你必须在你的设备上启动你的游戏，同时连接到电脑，通常你会在Unity看到分析器窗口，有你设备统计数据。 如果没有，打开分析器窗口，在“Active Profiler”下拉窗口，选择“AndroidPlayer(ADB…)”或者什么。那就是你的设备。</p>
<p>直接分析你的呃设备将给你提供你的游戏性能更准确的信息，所以选择这种方法。</p>
<div class="row imager" style="margin: 40px 0px;"> <img class="img-fluid mx-auto d-block" src="/assets/images/posts/Unity-Android_3.png" title="Unity-Android_3.png" alt="Unity-Android_3.png">
</div>
<p>编辑器日志 另一个可以获取构建信息的好工具是打开编辑器日志。在你编译好你的游戏之后打开控制台窗口（Window&gt;Console）,在右上角有个按钮，你可以点击它选择“打开编辑器日志”</p>
<p>它会打开一个有许多构建信息的文档，特别是关于构建大小的信息和占据空间的资产的信息。向下滚动文档，直到你找到像下面这样的内容：</p>
<div class="row imager" style="margin: 40px 0px;"> <img class="img-fluid mx-auto d-block" src="/assets/images/posts/Unity-Android_4.png" title="Unity-Android_4.png" alt="Unity-Android_4.png">
</div>
<p>定期在不同设备上测试 android设备的多样性是android开发的一个很大的困难，因为一个问题或者性能问题会可能会出现在一个设备上，而不会出现在其他的设备上。</p>
<p>这就是为什么你必须在不同的设备上测试你的游戏以防止问题的发生，并且确定它能兼容大量手机。 当然，在游戏结束时才做优化是很诱人的，但你将发现自己会陷入很多性能问题中。最好的的是定期分析你的游戏，比如在一个重要的里程碑上。事实上，游戏改动的越少，你将会越快速的找到是什么在消耗你的性能。</p>
<p>代码： 在进行渲染优化之前，我们希望我们的代码无可挑剔。事实上，如果你像我是一个程序员，并且你和美术一起工作，那么最好在指责美术之前先检查你的代码的性能。（即使所有的事情都确定是他们的错误。）</p>
<p>不要把所有的东西放在Update里。 Uniy初学者最大的错误之一就是过于依赖Update函数。很容易把所有的代码都放在它里面，检查这个或者那个并作出相应的反应，但如果在你场景中的每个GameObject都有一个Update函数去检查很东西并实现复杂的操作，这可能严重影响android性能。</p>
<p>所以，在使用Update函数之前，反思你的需求。它真的需要在每一帧被调用吗？</p>
<p>使用协程 如果不是这样，你有几个选项可以提高效率。</p>
<p>你可以使用协程每秒调用一个方法，例如，使用以下指令“yield return new WaitForSeconds (1);”它可以用来刷新一些UI显示：</p>
<div class="row imager" style="margin: 40px 0px;"> <img class="img-fluid mx-auto d-block" src="/assets/images/posts/Unity-Android_5.png" title="Unity-Android_5.png" alt="Unity-Android_5.png">
</div>
<p>或者你可以使用“yield return new WaitForEndOfFrame ();”等待两帧再调用你的方法。例如执行一个复杂的计算，而不是每一帧执行。</p>
<div class="row imager" style="margin: 40px 0px;"> <img class="img-fluid mx-auto d-block" src="/assets/images/posts/Unity-Android_6.png" title="Unity-Android_6.png" alt="Unity-Android_6.png">
</div>
<p>使用事件、动作和反应性编程 真正高效的是只在当你需要的时候才调用你的方法，例如当这个变量改变的时候、这个方法被调用的时候或者当事件发生的时候显示和UI弹出。。。。</p>
<p>这是反应性编程的原则，使用事件，其中一个动作调用反应。 在C#中你可以使用代理：https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/delegate</p>
<p>特别是动作代理：https://msdn.microsoft.com/en-us/library/system.action(v=vs.110).aspx</p>
<p>它允许你创建事件，当它们发生的时候你必须去调用它，那些事件会调用已经订阅了它的所有方法。</p>
<p>例如你创建了一个事件“OnPlayerJump”，在你的代码中每当你的角色跳跃的时候都会调用它，你订阅这个事件到一个方法，这个方法会去创建一些灰尘或者是一个播放跳跃声音的事件。这仅仅是个小介绍，如果你不懂，可应该去查一下。</p>
<p>如果你对反应编程感兴趣，可以在这个Unity 资产里查看：https://assetstore.unity.com/packages/tools/integration/unirx-reactive-extensions-for-unity-17276</p>
<p>使用Raycasts检查你的可触摸GameObjects 在Unity中，除了UI，没有任何简单的方法去检测屏幕上的GameObject的点击。你可以使用OnMouseDown()函数，但是Unity会在手机上阻止它的使用。</p>
<p>所有我们能做的就是使用Raycasts，从相机开始，到你手指触摸屏幕的地方。如果你触摸了一个对象类型，你可以调用它的一份方法。</p>
<p>这就是我做的，我也一个Touchable类，一份Touchable层，当屏幕上的发生触摸时，我会使用这个方法：</p>
<div class="row imager" style="margin: 40px 0px;"> <img class="img-fluid mx-auto d-block" src="/assets/images/posts/Unity-Android_7.png" title="Unity-Android_7.png" alt="Unity-Android_7.png">
</div>
<p>它检测一个可触摸的GameObject是否有触摸发生，如果发生了，我可以调用GameObject上的OnTouchDown ()方法。</p>
<p>物理 现在已经检查了你的代码，如果有物理交互，你肯定很想去检查一下如何去管理它们。在手机上最好什么也没有，但你必须去做，你必须小心一些简单的事情。</p>
<p>使用简单初级的碰撞器，而不是网格碰撞器，因为网格碰撞器的处理要复杂的多。 尽可能将“碰撞检测模式”设置为“离散”，因为“动态”要求更高的性能。 最后，你可以去TimeManager窗口（Edit&gt;Project Settings&gt;Time）,调整”Fixed Timestep”值。这个值表示两次调用FixedUpdate()方法之间的时间间隔。</p>
<p>因此，如果降低Fixed Timestep, 物理计算会被频繁的调用，从而得到个更精确的模拟，但是会使用更多的资源。另一方面，提高它可能会减少你的物理模拟时间，特别的是如果你不需要特别精确的模拟。</p>
<h2 id="gist-code">Gist code</h2>
<script src="https://gist.github.com/a3672f19f0f2ac35810b.js"> </script><p><br></p>
<p>To use, see:<a href="https://jektify.github.io" target="_blank">Jektify - Doc</a></p>
<dl class="jektify jektify--dark jektify--custom">
<dt class="jektify__header jektify__header--dark jektify__header--custom"> <a class="jektify__brand jektify__brand--dark jektify__brand--custom" href="https://jektify.github.io" target="_blank">jektify</a> <i class="jektify__year jektify__year--dark jektify__year--custom">© 2019 </i> <span class="jektify__button jektify__button--dark jektify__button--custom jektify__button--open">+</span>
</dt>
<dd class="jektify__body jektify__body--dark jektify__body--custom" style="display: block">
<h1 class="jektify__title jektify__title--dark jektify__user--dark jektify__title--custom" style="display: none;">Música</h1>
<p class="jektify__description jektify__description--dark jektify__description--custom" style="display: none;">Jekyll plugin to generate html snippets for embedding Spotify Musics. To listen to the full song, open your Spotify and start these musics.</p>
<div class="jektify__tracklist jektify__tracklist--dark jektify__tracklist--custom"> <iframe id="jektify__track" class="jektify__track jektify__track--dark jektify__track--custom" src="https://embed.spotify.com/?uri=spotify:track:62qsgMnY4wg8nE5qjyOdWO&amp;theme=dark" width="100%" height="80" frameborder="0" allowtransparency="true"></iframe>
</div>
</dd>
</dl>
<p>Goodbye! <img class="emoji" title=":wink:" alt=":wink:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f609.png" height="20" width="20"></p>
<hr style="border-top: 1px solid #9D9D9D ; color: #9D9D9D ;" class="endpost">
</div></div>
<div class="layout_post__dayquote">
<div class="row"><h2 class="layout_post__dayquote-title">The word of the day!</h2></div>
<div class="row"><p class="layout_post__dayquote-description">Put a very powerful message.</p></div>
</div>
<div class="layout_post__share">
<div class="row justify-content-center"><h2>分享</h2></div>
<div class="row justify-content-center">
<div class="offset-0 offset-sm-0 offset-md-0 offset-lg-2"></div>
<div class="text-center col-12 col-sm-3 col-md-3 col-lg-2"> <a class="btn btn-link btn-typing layout_post__share-fb" href="#" title="" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),'facebook-share-dialog','width=626,height=436');return false;">Facebook</a>
</div>
<div class="text-center col-12 col-sm-3 col-md-3 col-lg-2"> <a class="btn btn-link btn-typing layout_post__share-ln" href="http://www.linkedin.com/cws/share?url=https://flyingeye.cn/blog/Unity-Android%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/" onclick='window.open(this.href,"popupwindow","status=0,height=500,width=700,resizable=0,top=50,left=100");return false;' target="_blank" title="">Linkedin</a>
</div>
<div class="text-center col-12 col-sm-3 col-md-3 col-lg-2"> <a class="btn btn-link btn-typing layout_post__share-tw" href="https://twitter.com/intent/tweet?text=https://flyingeye.cn/blog/Unity-Android%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/%20-%20Unity:%20Android%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97(%E4%B8%8A)%20by%20" target="_blank" title="">Twitter</a>
</div>
<div class="offset-0 offset-sm-0 offset-md-0 offset-lg-2"></div>
</div>
</div>
<div class="layout_post__author"><div class="row"><div class="col-12 p-0 col-lg-12 ">
<p class="layout_post__author-title">作者</p>
<h2 class="font-weight-bold layout_post__author-name">xiaofeng</h2>
<p class="layout_post__author-description">Hi! I'm the xiaofeng. :)</p>
</div></div></div>
</div></div></div>
</div></div>
<div class="footer">
<div class="container-fluid"><div class="row">
<div class="col-12 col-md-4"> <span class="text-center footer__copyright">编程人生 © 2015-2019 • All right reserved.</span>
</div>
<div class="col-12 col-md-4 d-none d-md-block"> <span class="text-center footer__message">Simplicity is fashionable.</span>
</div>
<div class="col-12 col-md-4"> <span class="text-center footer__madeby">Made with <a href="https://jekyllrb.com" target="_blank">Jekyll</a> using <a href="https://github.com/williamcanin/typing-jekyll-template" target="_blank">Typing</a> Theme.</span>
</div>
</div></div>
<a class="footer__scrrolltop" href="#top"><i class="fas fa-caret-up"></i></a>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> <script type="text/javascript" src="https://flyingeye.cn/assets/js/post.js"></script> <script src="https://flyingeye.cn/assets/vendor/jektify/js/jektify.min.js"></script>
</div></body></html>
